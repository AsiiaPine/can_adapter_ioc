# OpenOCD configuration for STM32G0B1 with ST-Link
# This configuration helps prevent reset issues during debugging

# Interface configuration
source [find interface/stlink.cfg]

# Target configuration
source [find target/stm32g0x.cfg]

# Additional settings for STM32G0B1
adapter_khz 2000

# Reset configuration
reset_config srst_only

# Flash configuration
flash bank stm32g0x 0x08000000 0 0 0 $_TARGETNAME

# Debug settings
$_TARGETNAME configure -event reset-init {
    # Disable watchdog during debug
    mww 0x40003000 0x0000CCCC
    mww 0x40003004 0x0000CCCC
    
    # Set up proper clock for debugging
    mww 0x40021000 0x00000001  # Enable HSI
    sleep 100
    
    # Configure flash latency for higher clock
    mww 0x40022000 0x00000001  # Flash latency 1
}

# Prevent watchdog from triggering during debug
$_TARGETNAME configure -event halted {
    # Disable watchdog when halted
    mww 0x40003000 0x0000CCCC
    mww 0x40003004 0x0000CCCC
}

# Enable debug output
adapter_nsrst_delay 100
adapter_nsrst_assert_width 100 